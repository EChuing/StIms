//系统加载$(function(){	//监听是否长时间不进行操作	// 监听页面点击操作，刷新倒计时	$(document).click(function() {		window.parent.parent.sec = 600;	});	// 监听键盘输入操作，刷新倒计时	$(document).keyup(function() {		window.parent.parent.sec = 600;	});	doSkipToChild();	$(".bodyLoadingOver").remove();	showFinancilTypeSearch('financilSearch','');	$('#selectionReceiptDay').val(new Date().format('yyyy-MM-dd'));	//延迟加载	setTimeout(function(){		$('#selectionRegistrant').val(parent._loginUserName);		$('#selectionRegistrationTime').val(parent.formatDate(parent.getNowFormatDate()));		initDialog('houseSelectionDlg');	}, 1000);		$('#addTemporaryOBill').datagrid({			columns : 				[ [					{						field : 'nature',						title : '性质',						width : 20,						align : 'center'					},					{						field : 'species',						title : '种类',						width : 20,						align : 'center'					},					{						field : 'jciMoney',						title : '金额',						width : 20,						align : 'center',						editor : {							type : "numberbox",							options : {								precision : 2							}						},					},					{						field : 'jciRemark',						title : '备注',						width : 20,						align : 'center',						editor : 'textbox'					},					{						field : 'deleteAdd',						title : '删除',						width : 10,						align : 'center',						formatter : function(value, row, index) {							return "<a href='#' onclick=\"myDeleteRows('"+row.random+"','random','addTemporaryOBill',0);sumDataGrid(1);\">删除</a>";						}					} 				] ],			width : '100%',			height : '100%',			singleSelect : true,			autoRowHeight : false,			scrollbarSize : 0,			showPageList : false,			fitColumns : true,						enableCellEdit : true,// 表示是否开启单元格编辑功能			rowStyler : function(index, row) {				return 'color:#000;';			},		}	);	for (var i in parent._loginCompanyRentDistrict) {		$("#selectionCity").append("<option value = '" + parent._loginCompanyRentDistrict[i] + "'>" + parent._loginCompanyRentDistrict[i] + "</option>");	}		});/** *  选择房源窗口，选择临时账单所关联的房子 */function houseSelection(){	$('#houseSelectionDlg').dialog({		top 	: getTop(350),		left 	: getLeft(650),		title 	: '房源选择',		closed	: true,		width	: 650,		height	: 350,		cache 	: false,		modal 	: true,		onClose : function(){			$('#houseSelectionDlg [clear="clear"]').val('');		}	});	$('#houseSelectionDlg').dialog("open");	loadHouseData(1,1);	$('#houseSelectionDg').datagrid({		onDblClickRow : function(rowIndex, rowData){			console.log(rowData);			$('#hrId').val(rowData.hrId);			$('#hsId').val(rowData.hrHouse4storeId);			$('#houseId').val(rowData.hrHouseId);			$('#renterId').val(rowData.hrRenterId);			$('#landlordId').val(rowData.hrLandlordId);			$('#selectionAddress').val(rowData.hrAddCommunity + ' ' + rowData.hrAddBuilding + ' ' +rowData.hrAddDoorplateno);			$('#selectionCustomerName').val(rowData.addPopName);			$('#selectionContactInformation').val(rowData.renterPopTelephone);			$('#houseSelectionDlg').dialog('close')		}	});}//加载房屋数据function loadHouseData(page, type){	var startNum = (parseInt(page) - 1) * 7;	var endNum = 7;	var selectionCity = $('#selectionCity').val();	var selectionCommunity = $('#selectionCommunity').val();	var selectionBuilding = $('#selectionBuilding').val();	var selectionDoorplateno = $('#selectionDoorplateno').val();	$.post("../queryRentingSourceData.action",{		startNum 			: startNum,		endNum 				: endNum,		hrAddDistrict       : selectionCity,		hrAddCommunity      : selectionCommunity,		hrAddBuilding       : selectionBuilding,		hrAddDoorplateno    : selectionDoorplateno,	},function(data) {		if (data.code < 0) {			sourcePage(0, endNum, 'houseSelectionPageDiv','houseDataPage', 'loadHouseData', 1);			$('#houseSelectionDg').datagrid({				data : [],				view : myview,				emptyMsg : data.msg			});			return;		}		data = data.body;//		console.log(data);		if (page == 1 && type == 1) {			sourcePage(data[0].totalNum, endNum, 'houseSelectionPageDiv','houseDataPage', 'loadHouseData', 1);		}		for(var i in data){			for(var j in data[i]){				if(data[i][j]==null){					data[i][j]='';				}			}			data[i].addDistrict = data[i].hrAddDistrict;			data[i].addCommunity = data[i].hrAddCommunity;			data[i].addBuilding = data[i].hrAddBuilding;			data[i].addDoorplateno = data[i].hrAddDoorplateno;			data[i].addPopName = data[i].renterPopName;		}		$("#houseSelectionDg").datagrid("loadData", data);	});}//生成账单function generatingBill(){	var rows = $('#addTemporaryOBill').datagrid('getRows')	console.log(rows)	var totalMoney = 0;	var note = '';	for(var i in rows){		totalMoney += parseFloat(rows[i].jciMoney);		note += rows[i].species;	}	totalMoney = totalMoney.toFixed(2);	var jciMessageNote = {		sys : {			rent	: totalMoney,			water 	: 0,			elect 	: 0,			gas 	: 0,			hotWater : 0,			hotAir : 0,			owe		: 0,			tv 		: 0,			wifi 	: 0,			manager : 0,			server 	: 0,			other	: 0,			power	: totalMoney,			damages	: 0,			total 	: totalMoney,		},		msg : {			rent	: 0,			water 	: 0,			elect 	: 0,			gas 	: 0,			hotWater : 0,			hotAir : 0,			owe		: 0,			tv 		: 0,			wifi 	: 0,			manager : 0,			server 	: 0,			power	: totalMoney,			damages	: 0,			total 	: totalMoney,			other	: 0,		},		note:note,		waterThis : 0,		electThis : 0,		gasThis : 0,		hotWaterThis : 0,		hotAirThis : 0,		waterLast : 0,		electLast : 0,		gasLast : 0,		hotWaterLast : 0,		hotAirLast : 0,		waterDate : 0,		electDate : 0,		gasDate : 0,		hotWaterDate : 0,		hotAirDate : 0,	};	var jciRegisterPeople = parent._loginUserId;	var jciHouse4rentId = $('#hrId').val();	var jciHouse4storeId = $('#hsId').val();	var jciDepartment = parent._loginDepartment;	var jciStorefront = parent._loginStore;	var jciLandlordId = $('#landlordId').val();	var jciRenterId = $('#renterId').val();	var jciFukuanri = $('#selectionReceiptDay').val();	var jciNature = '应收'	var jciType = '租客租金'	var jciMoney = $('#replacedFinancialTotal').val();	var jciState = '待收'	var jciRemark = $('#selectionRemarks').val();	var jciLabelType = $('#selectionLabelType').val();		var rows = $('#addTemporaryOBill').datagrid('getRows');	var billJson = JSON.stringify(rows);	console.log(billJson);	if (rows.length==0){		myTips('请添加账单!', 'error');		return;	}	showLoading();	$.post('../insertSelective.action',{		jciRegisterPeople   : jciRegisterPeople,		jciHouse4rentId     : jciHouse4rentId,		jciHouse4storeId    : jciHouse4storeId,		jciDepartment       : jciDepartment,		jciStorefront       : jciStorefront,		jciLandlordId       : jciLandlordId,		jciRenterId         : jciRenterId,		jciFukuanri         : jciFukuanri,		jciNature           : jciNature,		jciType             : jciType,		jciMoney            : jciMoney,		jciState            : jciState,		jciRemark           : jciRemark,		jciLabelType        : jciLabelType,		jciBillJson			: billJson,		jciMessageNote		: JSON.stringify(jciMessageNote),		jciLabelType  		: 1	},function(data){		hideLoading();		if (data.code < 0) {			myTips('账单添加失败!','error');			return;		}else{			myTips('添加成功！', 'success');			setTimeout(function(){				parent.$('#generatingATemporaryBillDlg').dialog('close');			}, 1000);		}	});}function addTemporaryBill() {	var jciRegisterPeople = parent._loginUserId;	var jciHouse4rentId = $('#hrId').val();	var jciHouse4storeId = $('#hsId').val();	var jciDepartment = parent._loginDepartment;	var jciStorefront = parent._loginStore;	var jciLandlordId = $('#landlordId').val();	var jciRenterId = $('#renterId').val();	var jciFukuanri = $('#selectionReceiptDay').val();	var jciNature = '应收'	var jciType = '租客租金'	var jciMoney = $('#selectionAmountOfMoney').val();	var jciState = '待收'	var jciRemark = $('#selectionRemarks').val();	var jciLabelType = $('#selectionLabelType').val();		var nature = $('#financilSearchJfNatureOfThe').val();	var classification = $('#financilSearchJfBigType').val();	var species = $('#financilSearchJfAccountingSpecies').val();		var checkFlag = 0;	$('#creatingATemporaryBillDlg [require="require"]').each(function(){		if($(this).val()==''){			$(this).css("border","1px solid red");			checkFlag++;		}else{			$(this).css("border","1px solid #A9A9A9");		}	});	if(checkFlag!=0){		myTips("有必填项未填写!","error");		return;	}	var random = parseInt((Math.random()*9+1)*10000000);	var dataJson = {			jciRegisterPeople 		: jciRegisterPeople,			jciHouse4rentId 		: jciHouse4rentId,			jciHouse4storeId 		: jciHouse4storeId,			jciDepartment 			: jciDepartment,			jciStorefront 			: jciStorefront,			jciLandlordId			: jciLandlordId,			jciRenterId 			: jciRenterId,			jciFukuanri				: jciFukuanri,			jciNature				: jciNature,			jciType					: jciType,			jciMoney				: jciMoney,			jciState				: jciState,			jciRemark				: jciRemark,			jciLabelType			: jciLabelType,			nature					: nature,			classification			: classification,			species					: species,			random					: random,		};	var rows = $("#addTemporaryOBill").datagrid("getRows");	var dataFlag = 0;	for (var i = 0; i < rows.length; i++) {		if (rows[i].species == species && rows[i].jciLabelType == jciLabelType) {			if (dataFlag == 0) {				dataFlag++;				$.messager.confirm("操作提示", "有相同收支种类的数据存在,是否继续添加？", function(						data) {					if (!data) {						return;					} else {						dataFlag = 0;						toDataGrid(dataJson, dataFlag);						return;					}				});			}		} else if (rows[i].jciMoney == jciMoney) {			if (dataFlag == 0) {				dataFlag++;				$.messager.confirm("操作提示", "有相同数额的收支金额的数据存在,是否继续添加？", function(						data) {					if (!data) {						return;					} else {						dataFlag = 0;						toDataGrid(dataJson, dataFlag);						return;					}				});			}		}	}	toDataGrid(dataJson, dataFlag);}function toDataGrid(data, dataFlag) {	if (dataFlag != 0) {		return;	}	$('#addTemporaryOBill').datagrid('insertRow', {		index : 0,		row : data	});//	financialLink('add_financial_state','add_financial_type','addFinancialBigType');	$('#financilSearchJfNatureOfThe').val('');	$('#financilSearchJfBigType').val('');	$('#financilSearchJfAccountingSpecies').val('');	/*$('#selectinputnameadd_financial_type').val('');*/	/*$('#add_financial_belongBegin').val('');*/	$('#selectionAmountOfMoney').val('');	$('#selectionRemarks').val('');	/*$('.add_financial_money').val('');	$('.add_financial_nums').val('');	$('.add_financial_note').val('');*/	sumDataGrid();}//余额增加function sumDataGrid() {	var money = 0;	var rows = $('#addTemporaryOBill').datagrid('getRows');	/*console.log(rows);*/	for(var i = 0; i < rows.length; i++){		var jciMoney=rows[i].jciMoney		money=mySum(money,jciMoney);		}	$('#replacedFinancialTotal').val(money);}/** *  分页 *  parameter totalNum 总条数 *  parameter pageSize 单页总条数 *  parameter pageDiv 分页的id *  parameter pageName 页码的id *  parameter fun 查询函数 *  parameter type 分页刷新类型（1.重新加载数据，2.重新加载数据并选中刷新前选中的数据） */function sourcePage(totalNum, pageSize, pageDiv, pageName, fun, type){	var pageNum = Math.ceil(totalNum / pageSize);	if(type == 1){		$("#"+pageName).remove();		$("#"+pageDiv).append("<div class='tcdPageCode' id='"+pageName+"' style='text-align:center;'></div>");		$("#"+pageName).createPage({			onePageNums : pageSize,			totalNum    : totalNum,			pageCount   : pageNum,			current     : 1,			backFn : function(p) {				if (p <= pageNum) {					eval(fun+'('+p+', 1)');				}			}		});	}else if(type == 2){			}}